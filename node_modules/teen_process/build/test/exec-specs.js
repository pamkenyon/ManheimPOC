require('source-map-support').install();

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _2 = require('..');

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _helpers = require('./helpers');

var _appiumSupport = require('appium-support');

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var should = _chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('exec', function () {
  it('should work with arguments like spawn', function callee$1$0() {
    var cmd, args, _ref, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = 'ls';
          args = [__dirname];
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap((0, _2.exec)(cmd, args));

        case 4:
          _ref = context$2$0.sent;
          stdout = _ref.stdout;
          stderr = _ref.stderr;
          code = _ref.code;

          stdout.should.contain("exec-specs.js");
          stderr.should.equal("");
          code.should.equal(0);

        case 11:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should throw an error if command does not exist', function callee$1$0() {
    var cmd, err;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = 'doesnoteexist';
          err = undefined;
          context$2$0.prev = 2;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap((0, _2.exec)(cmd));

        case 5:
          context$2$0.next = 10;
          break;

        case 7:
          context$2$0.prev = 7;
          context$2$0.t0 = context$2$0['catch'](2);

          err = context$2$0.t0;

        case 10:
          should.exist(err);
          err.message.should.include('not found');

        case 12:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this, [[2, 7]]);
  });

  it('should throw an error with a bad exit code', function callee$1$0() {
    var cmd, err;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = (0, _helpers.getFixture)("bad_exit");
          err = undefined;
          context$2$0.prev = 2;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap((0, _2.exec)(cmd));

        case 5:
          context$2$0.next = 10;
          break;

        case 7:
          context$2$0.prev = 7;
          context$2$0.t0 = context$2$0['catch'](2);

          err = context$2$0.t0;

        case 10:
          should.exist(err);
          err.stdout.trim().should.equal("foo");
          err.stderr.trim().should.equal("bar");
          err.code.should.equal(1);

        case 14:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this, [[2, 7]]);
  });

  it('should work with spaces in arguments', function callee$1$0() {
    var cmd, echo1, echo2, _ref2, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = (0, _helpers.getFixture)("echo");
          echo1 = "my name is bob";
          echo2 = "lol";
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap((0, _2.exec)(cmd, [echo1, echo2]));

        case 5:
          _ref2 = context$2$0.sent;
          stdout = _ref2.stdout;
          stderr = _ref2.stderr;
          code = _ref2.code;

          stdout.trim().should.equal(echo1);
          stderr.trim().should.equal(echo2);
          code.should.equal(0);

        case 12:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should work with backslashes in arguments', function callee$1$0() {
    var cmd, echo1, echo2, _ref3, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = (0, _helpers.getFixture)("echo");
          echo1 = "my\\ name\\ is\\ bob";
          echo2 = "lol";
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap((0, _2.exec)(cmd, [echo1, echo2]));

        case 5:
          _ref3 = context$2$0.sent;
          stdout = _ref3.stdout;
          stderr = _ref3.stderr;
          code = _ref3.code;

          stdout.trim().should.equal(echo1);
          stderr.trim().should.equal(echo2);
          code.should.equal(0);

        case 12:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should work with spaces in commands', function callee$1$0() {
    var cmd, echo1, echo2, _ref4, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = (0, _helpers.getFixture)("echo with space");
          echo1 = "bobbob";
          echo2 = "lol";
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap((0, _2.exec)(cmd, [echo1, echo2]));

        case 5:
          _ref4 = context$2$0.sent;
          stdout = _ref4.stdout;
          stderr = _ref4.stderr;
          code = _ref4.code;

          stdout.trim().should.equal(echo1);
          stderr.trim().should.equal(echo2);
          code.should.equal(0);

        case 12:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should work with spaces in commands and arguments', function callee$1$0() {
    var cmd, echo1, echo2, _ref5, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = (0, _helpers.getFixture)("echo with space");
          echo1 = "my name is bob";
          echo2 = "lol";
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap((0, _2.exec)(cmd, [echo1, echo2]));

        case 5:
          _ref5 = context$2$0.sent;
          stdout = _ref5.stdout;
          stderr = _ref5.stderr;
          code = _ref5.code;

          stdout.trim().should.equal(echo1);
          stderr.trim().should.equal(echo2);
          code.should.equal(0);

        case 12:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should respect cwd', function callee$1$0() {
    var cmd, echo1, echo2, cwd, _ref6, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = _appiumSupport.system.isWindows() ? "echo.bat" : "./echo.sh";
          echo1 = "my name is bob";
          echo2 = "lol";
          cwd = _path2['default'].dirname((0, _helpers.getFixture)("echo"));
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap((0, _2.exec)(cmd, [echo1, echo2], { cwd: cwd }));

        case 6:
          _ref6 = context$2$0.sent;
          stdout = _ref6.stdout;
          stderr = _ref6.stderr;
          code = _ref6.code;

          stdout.trim().should.equal(echo1);
          stderr.trim().should.equal(echo2);
          code.should.equal(0);

        case 13:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should respect env', function callee$1$0() {
    var cmd, env, _ref7, stdout, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = (0, _helpers.getFixture)("env");
          env = { FOO: "lolol" };
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap((0, _2.exec)(cmd, [], { env: env }));

        case 4:
          _ref7 = context$2$0.sent;
          stdout = _ref7.stdout;
          code = _ref7.code;

          stdout.trim().should.equal(env.FOO + ' ' + env.FOO);
          code.should.equal(0);

        case 9:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should allow a timeout parameter', function callee$1$0() {
    var cmd, args, err;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = "sleep";
          args = ["10"];
          err = undefined;
          context$2$0.prev = 3;
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap((0, _2.exec)(cmd, args, { timeout: 500 }));

        case 6:
          context$2$0.next = 11;
          break;

        case 8:
          context$2$0.prev = 8;
          context$2$0.t0 = context$2$0['catch'](3);

          err = context$2$0.t0;

        case 11:
          should.exist(err);
          err.message.should.contain("timed out");
          err.message.should.contain(cmd);

        case 14:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this, [[3, 8]]);
  });

  it('should allow large amounts of output', function callee$1$0() {
    var _ref8, stdout;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          this.timeout(24000);
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap((0, _2.exec)((0, _helpers.getFixture)("bigbuffer.js")));

        case 3:
          _ref8 = context$2$0.sent;
          stdout = _ref8.stdout;

          stdout.length.should.be.above(512 * 1024);

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should ignore output if requested', function callee$1$0() {
    var cmd, echo1, _ref9, stdout, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = (0, _helpers.getFixture)("echo.sh");
          echo1 = "my name is bob";
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap((0, _2.exec)(cmd, [echo1], { ignoreOutput: true }));

        case 4:
          _ref9 = context$2$0.sent;
          stdout = _ref9.stdout;
          code = _ref9.code;

          stdout.should.equal("");
          code.should.equal(0);

        case 9:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should return a Buffer if requested', function callee$1$0() {
    var cmd, echo1, _ref10, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = (0, _helpers.getFixture)("echo.sh");
          echo1 = "my name is bob";
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap((0, _2.exec)(cmd, [echo1], { isBuffer: true }));

        case 4:
          _ref10 = context$2$0.sent;
          stdout = _ref10.stdout;
          stderr = _ref10.stderr;
          code = _ref10.code;

          _lodash2['default'].isString(stdout).should.be['false'];
          _lodash2['default'].isBuffer(stdout).should.be['true'];
          _lodash2['default'].isString(stderr).should.be['false'];
          _lodash2['default'].isBuffer(stderr).should.be['true'];
          code.should.equal(0);

        case 13:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  describe('binary output', function () {
    var PNG_MAGIC = '89504e47';
    var PNG_MAGIC_LENGTH = 4;

    it('should allow binary output', function callee$2$0() {
      var _ref11, stdout, signature;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _2.exec)('cat', [(0, _helpers.getFixture)('screenshot.png')], { encoding: 'binary' }));

          case 2:
            _ref11 = context$3$0.sent;
            stdout = _ref11.stdout;

            _lodash2['default'].isString(stdout).should.be['true'];
            _lodash2['default'].isBuffer(stdout).should.be['false'];
            signature = Buffer.from(stdout, 'binary').toString('hex', 0, PNG_MAGIC_LENGTH);

            signature.should.eql(PNG_MAGIC);

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should allow binary output as Buffer', function callee$2$0() {
      var _ref12, stdout, signature;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _2.exec)('cat', [(0, _helpers.getFixture)('screenshot.png')], { encoding: 'binary', isBuffer: true }));

          case 2:
            _ref12 = context$3$0.sent;
            stdout = _ref12.stdout;

            _lodash2['default'].isString(stdout).should.be['false'];
            _lodash2['default'].isBuffer(stdout).should.be['true'];
            signature = stdout.toString('hex', 0, PNG_MAGIC_LENGTH);

            signature.should.eql(PNG_MAGIC);

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should allow binary output from timeout', function callee$2$0() {
      var stdout;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.prev = 0;
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap((0, _2.exec)('cat', [(0, _helpers.getFixture)('screenshot.png')], { encoding: 'binary', timeout: 1 }));

          case 3:
            context$3$0.next = 10;
            break;

          case 5:
            context$3$0.prev = 5;
            context$3$0.t0 = context$3$0['catch'](0);
            stdout = context$3$0.t0.stdout;

            _lodash2['default'].isString(stdout).should.be['true'];
            _lodash2['default'].isBuffer(stdout).should.be['false'];

          case 10:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this, [[0, 5]]);
    });

    it('should allow binary output as Buffer from timeout', function callee$2$0() {
      var stdout;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.prev = 0;
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap((0, _2.exec)('cat', [(0, _helpers.getFixture)('screenshot.png')], { encoding: 'binary', timeout: 1, isBuffer: true }));

          case 3:
            context$3$0.next = 10;
            break;

          case 5:
            context$3$0.prev = 5;
            context$3$0.t0 = context$3$0['catch'](0);
            stdout = context$3$0.t0.stdout;

            _lodash2['default'].isString(stdout).should.be['false'];
            _lodash2['default'].isBuffer(stdout).should.be['true'];

          case 10:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this, [[0, 5]]);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZXhlYy1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7OztvQkFFaUIsTUFBTTs7OztpQkFDRixJQUFJOztvQkFDUixNQUFNOzs7OzhCQUNJLGtCQUFrQjs7Ozt1QkFDbEIsV0FBVzs7NkJBQ2YsZ0JBQWdCOztzQkFDekIsUUFBUTs7OztBQUd0QixJQUFNLE1BQU0sR0FBRyxrQkFBSyxNQUFNLEVBQUUsQ0FBQztBQUM3QixrQkFBSyxHQUFHLDZCQUFnQixDQUFDOztBQUV6QixRQUFRLENBQUMsTUFBTSxFQUFFLFlBQVk7QUFDM0IsSUFBRSxDQUFDLHVDQUF1QyxFQUFFO1FBQ3RDLEdBQUcsRUFDSCxJQUFJLFFBQ0gsTUFBTSxFQUFFLE1BQU0sRUFBRSxJQUFJOzs7OztBQUZyQixhQUFHLEdBQUcsSUFBSTtBQUNWLGNBQUksR0FBRyxDQUFDLFNBQVMsQ0FBQzs7MkNBQ2EsYUFBSyxHQUFHLEVBQUUsSUFBSSxDQUFDOzs7O0FBQTdDLGdCQUFNLFFBQU4sTUFBTTtBQUFFLGdCQUFNLFFBQU4sTUFBTTtBQUFFLGNBQUksUUFBSixJQUFJOztBQUN6QixnQkFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDdkMsZ0JBQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ3hCLGNBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDOzs7Ozs7O0dBQ3RCLENBQUMsQ0FBQzs7QUFFSCxJQUFFLENBQUMsaURBQWlELEVBQUU7UUFDaEQsR0FBRyxFQUNILEdBQUc7Ozs7QUFESCxhQUFHLEdBQUcsZUFBZTtBQUNyQixhQUFHOzs7MkNBRUMsYUFBSyxHQUFHLENBQUM7Ozs7Ozs7Ozs7QUFFZixhQUFHLGlCQUFJLENBQUM7OztBQUVWLGdCQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ2xCLGFBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQzs7Ozs7OztHQUN6QyxDQUFDLENBQUM7O0FBRUgsSUFBRSxDQUFDLDRDQUE0QyxFQUFFO1FBQzNDLEdBQUcsRUFDSCxHQUFHOzs7O0FBREgsYUFBRyxHQUFHLHlCQUFXLFVBQVUsQ0FBQztBQUM1QixhQUFHOzs7MkNBRUMsYUFBSyxHQUFHLENBQUM7Ozs7Ozs7Ozs7QUFFZixhQUFHLGlCQUFJLENBQUM7OztBQUVWLGdCQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ2xCLGFBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUN0QyxhQUFHLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDdEMsYUFBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDOzs7Ozs7O0dBQzFCLENBQUMsQ0FBQzs7QUFFSCxJQUFFLENBQUMsc0NBQXNDLEVBQUU7UUFDckMsR0FBRyxFQUNILEtBQUssRUFDTCxLQUFLLFNBQ0osTUFBTSxFQUFFLE1BQU0sRUFBRSxJQUFJOzs7OztBQUhyQixhQUFHLEdBQUcseUJBQVcsTUFBTSxDQUFDO0FBQ3hCLGVBQUssR0FBRyxnQkFBZ0I7QUFDeEIsZUFBSyxHQUFHLEtBQUs7OzJDQUNrQixhQUFLLEdBQUcsRUFBRSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQzs7OztBQUF2RCxnQkFBTSxTQUFOLE1BQU07QUFBRSxnQkFBTSxTQUFOLE1BQU07QUFBRSxjQUFJLFNBQUosSUFBSTs7QUFDekIsZ0JBQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ2xDLGdCQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNsQyxjQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQzs7Ozs7OztHQUN0QixDQUFDLENBQUM7O0FBRUgsSUFBRSxDQUFDLDJDQUEyQyxFQUFFO1FBQzFDLEdBQUcsRUFDSCxLQUFLLEVBQ0wsS0FBSyxTQUNKLE1BQU0sRUFBRSxNQUFNLEVBQUUsSUFBSTs7Ozs7QUFIckIsYUFBRyxHQUFHLHlCQUFXLE1BQU0sQ0FBQztBQUN4QixlQUFLLEdBQUcsc0JBQXNCO0FBQzlCLGVBQUssR0FBRyxLQUFLOzsyQ0FDa0IsYUFBSyxHQUFHLEVBQUUsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7Ozs7QUFBdkQsZ0JBQU0sU0FBTixNQUFNO0FBQUUsZ0JBQU0sU0FBTixNQUFNO0FBQUUsY0FBSSxTQUFKLElBQUk7O0FBQ3pCLGdCQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNsQyxnQkFBTSxDQUFDLElBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDbEMsY0FBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Ozs7Ozs7R0FDdEIsQ0FBQyxDQUFDOztBQUVILElBQUUsQ0FBQyxxQ0FBcUMsRUFBRTtRQUNwQyxHQUFHLEVBQ0gsS0FBSyxFQUNMLEtBQUssU0FDSixNQUFNLEVBQUUsTUFBTSxFQUFFLElBQUk7Ozs7O0FBSHJCLGFBQUcsR0FBRyx5QkFBVyxpQkFBaUIsQ0FBQztBQUNuQyxlQUFLLEdBQUcsUUFBUTtBQUNoQixlQUFLLEdBQUcsS0FBSzs7MkNBQ2tCLGFBQUssR0FBRyxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDOzs7O0FBQXZELGdCQUFNLFNBQU4sTUFBTTtBQUFFLGdCQUFNLFNBQU4sTUFBTTtBQUFFLGNBQUksU0FBSixJQUFJOztBQUN6QixnQkFBTSxDQUFDLElBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDbEMsZ0JBQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ2xDLGNBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDOzs7Ozs7O0dBQ3RCLENBQUMsQ0FBQzs7QUFFSCxJQUFFLENBQUMsbURBQW1ELEVBQUU7UUFDbEQsR0FBRyxFQUNILEtBQUssRUFDTCxLQUFLLFNBQ0osTUFBTSxFQUFFLE1BQU0sRUFBRSxJQUFJOzs7OztBQUhyQixhQUFHLEdBQUcseUJBQVcsaUJBQWlCLENBQUM7QUFDbkMsZUFBSyxHQUFHLGdCQUFnQjtBQUN4QixlQUFLLEdBQUcsS0FBSzs7MkNBQ2tCLGFBQUssR0FBRyxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDOzs7O0FBQXZELGdCQUFNLFNBQU4sTUFBTTtBQUFFLGdCQUFNLFNBQU4sTUFBTTtBQUFFLGNBQUksU0FBSixJQUFJOztBQUN6QixnQkFBTSxDQUFDLElBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDbEMsZ0JBQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ2xDLGNBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDOzs7Ozs7O0dBQ3RCLENBQUMsQ0FBQzs7QUFFSCxJQUFFLENBQUMsb0JBQW9CLEVBQUU7UUFDbkIsR0FBRyxFQUNILEtBQUssRUFDTCxLQUFLLEVBQ0wsR0FBRyxTQUNGLE1BQU0sRUFBRSxNQUFNLEVBQUUsSUFBSTs7Ozs7QUFKckIsYUFBRyxHQUFHLHNCQUFPLFNBQVMsRUFBRSxHQUFHLFVBQVUsR0FBRyxXQUFXO0FBQ25ELGVBQUssR0FBRyxnQkFBZ0I7QUFDeEIsZUFBSyxHQUFHLEtBQUs7QUFDYixhQUFHLEdBQUcsa0JBQUssT0FBTyxDQUFDLHlCQUFXLE1BQU0sQ0FBQyxDQUFDOzsyQ0FDUCxhQUFLLEdBQUcsRUFBRSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsRUFBRSxFQUFDLEdBQUcsRUFBSCxHQUFHLEVBQUMsQ0FBQzs7OztBQUE5RCxnQkFBTSxTQUFOLE1BQU07QUFBRSxnQkFBTSxTQUFOLE1BQU07QUFBRSxjQUFJLFNBQUosSUFBSTs7QUFDekIsZ0JBQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ2xDLGdCQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNsQyxjQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQzs7Ozs7OztHQUN0QixDQUFDLENBQUM7O0FBRUgsSUFBRSxDQUFDLG9CQUFvQixFQUFFO1FBQ25CLEdBQUcsRUFDSCxHQUFHLFNBQ0YsTUFBTSxFQUFFLElBQUk7Ozs7O0FBRmIsYUFBRyxHQUFHLHlCQUFXLEtBQUssQ0FBQztBQUN2QixhQUFHLEdBQUcsRUFBQyxHQUFHLEVBQUUsT0FBTyxFQUFDOzsyQ0FDRyxhQUFLLEdBQUcsRUFBRSxFQUFFLEVBQUUsRUFBQyxHQUFHLEVBQUgsR0FBRyxFQUFDLENBQUM7Ozs7QUFBMUMsZ0JBQU0sU0FBTixNQUFNO0FBQUUsY0FBSSxTQUFKLElBQUk7O0FBQ2pCLGdCQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBSSxHQUFHLENBQUMsR0FBRyxTQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUcsQ0FBQztBQUNwRCxjQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQzs7Ozs7OztHQUN0QixDQUFDLENBQUM7O0FBRUgsSUFBRSxDQUFDLGtDQUFrQyxFQUFFO1FBQ2pDLEdBQUcsRUFDSCxJQUFJLEVBQ0osR0FBRzs7OztBQUZILGFBQUcsR0FBRyxPQUFPO0FBQ2IsY0FBSSxHQUFHLENBQUMsSUFBSSxDQUFDO0FBQ2IsYUFBRzs7OzJDQUVDLGFBQUssR0FBRyxFQUFFLElBQUksRUFBRSxFQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUMsQ0FBQzs7Ozs7Ozs7OztBQUVyQyxhQUFHLGlCQUFJLENBQUM7OztBQUVWLGdCQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ2xCLGFBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUN4QyxhQUFHLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7Ozs7Ozs7R0FDakMsQ0FBQyxDQUFDOztBQUVILElBQUUsQ0FBQyxzQ0FBc0MsRUFBRTtlQUVwQyxNQUFNOzs7OztBQURYLGNBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7OzJDQUNDLGFBQUsseUJBQVcsY0FBYyxDQUFDLENBQUM7Ozs7QUFBaEQsZ0JBQU0sU0FBTixNQUFNOztBQUNYLGdCQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsQ0FBQzs7Ozs7OztHQUMzQyxDQUFDLENBQUM7O0FBRUgsSUFBRSxDQUFDLG1DQUFtQyxFQUFFO1FBQ2xDLEdBQUcsRUFDSCxLQUFLLFNBQ0osTUFBTSxFQUFFLElBQUk7Ozs7O0FBRmIsYUFBRyxHQUFHLHlCQUFXLFNBQVMsQ0FBQztBQUMzQixlQUFLLEdBQUcsZ0JBQWdCOzsyQ0FDRCxhQUFLLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUMsWUFBWSxFQUFFLElBQUksRUFBQyxDQUFDOzs7O0FBQTlELGdCQUFNLFNBQU4sTUFBTTtBQUFFLGNBQUksU0FBSixJQUFJOztBQUNqQixnQkFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDeEIsY0FBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Ozs7Ozs7R0FDdEIsQ0FBQyxDQUFDOztBQUVILElBQUUsQ0FBQyxxQ0FBcUMsRUFBRTtRQUNwQyxHQUFHLEVBQ0gsS0FBSyxVQUNKLE1BQU0sRUFBRSxNQUFNLEVBQUUsSUFBSTs7Ozs7QUFGckIsYUFBRyxHQUFHLHlCQUFXLFNBQVMsQ0FBQztBQUMzQixlQUFLLEdBQUcsZ0JBQWdCOzsyQ0FDTyxhQUFLLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUMsUUFBUSxFQUFFLElBQUksRUFBQyxDQUFDOzs7O0FBQWxFLGdCQUFNLFVBQU4sTUFBTTtBQUFFLGdCQUFNLFVBQU4sTUFBTTtBQUFFLGNBQUksVUFBSixJQUFJOztBQUN6Qiw4QkFBRSxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsU0FBTSxDQUFDO0FBQ25DLDhCQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxRQUFLLENBQUM7QUFDbEMsOEJBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFNBQU0sQ0FBQztBQUNuQyw4QkFBRSxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsUUFBSyxDQUFDO0FBQ2xDLGNBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDOzs7Ozs7O0dBQ3RCLENBQUMsQ0FBQzs7QUFFSCxVQUFRLENBQUMsZUFBZSxFQUFFLFlBQVk7QUFDcEMsUUFBTSxTQUFTLEdBQUcsVUFBVSxDQUFDO0FBQzdCLFFBQU0sZ0JBQWdCLEdBQUcsQ0FBQyxDQUFDOztBQUUzQixNQUFFLENBQUMsNEJBQTRCLEVBQUU7a0JBQzFCLE1BQU0sRUFHTCxTQUFTOzs7Ozs7NkNBSE0sYUFBSyxLQUFLLEVBQUUsQ0FBQyx5QkFBVyxnQkFBZ0IsQ0FBQyxDQUFDLEVBQUUsRUFBQyxRQUFRLEVBQUUsUUFBUSxFQUFDLENBQUM7Ozs7QUFBakYsa0JBQU0sVUFBTixNQUFNOztBQUNYLGdDQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxRQUFLLENBQUM7QUFDbEMsZ0NBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFNBQU0sQ0FBQztBQUM3QixxQkFBUyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLGdCQUFnQixDQUFDOztBQUNwRixxQkFBUyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7Ozs7Ozs7S0FDakMsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQyxzQ0FBc0MsRUFBRTtrQkFDcEMsTUFBTSxFQUdMLFNBQVM7Ozs7Ozs2Q0FITSxhQUFLLEtBQUssRUFBRSxDQUFDLHlCQUFXLGdCQUFnQixDQUFDLENBQUMsRUFBRSxFQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBQyxDQUFDOzs7O0FBQWpHLGtCQUFNLFVBQU4sTUFBTTs7QUFDWCxnQ0FBRSxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsU0FBTSxDQUFDO0FBQ25DLGdDQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxRQUFLLENBQUM7QUFDNUIscUJBQVMsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxDQUFDLEVBQUUsZ0JBQWdCLENBQUM7O0FBQzdELHFCQUFTLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQzs7Ozs7OztLQUNqQyxDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLHlDQUF5QyxFQUFFO1VBSXRDLE1BQU07Ozs7Ozs2Q0FGSixhQUFLLEtBQUssRUFBRSxDQUFDLHlCQUFXLGdCQUFnQixDQUFDLENBQUMsRUFBRSxFQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBQyxDQUFDOzs7Ozs7Ozs7QUFFL0Usa0JBQU0sR0FBRyxlQUFJLE1BQU07O0FBQ3ZCLGdDQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxRQUFLLENBQUM7QUFDbEMsZ0NBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFNBQU0sQ0FBQzs7Ozs7OztLQUV0QyxDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLG1EQUFtRCxFQUFFO1VBSWhELE1BQU07Ozs7Ozs2Q0FGSixhQUFLLEtBQUssRUFBRSxDQUFDLHlCQUFXLGdCQUFnQixDQUFDLENBQUMsRUFBRSxFQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFDLENBQUM7Ozs7Ozs7OztBQUUvRixrQkFBTSxHQUFHLGVBQUksTUFBTTs7QUFDdkIsZ0NBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFNBQU0sQ0FBQztBQUNuQyxnQ0FBRSxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsUUFBSyxDQUFDOzs7Ozs7O0tBRXJDLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L2V4ZWMtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0cmFuc3BpbGU6bW9jaGFcblxuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAnLi4nO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgeyBnZXRGaXh0dXJlIH0gZnJvbSAnLi9oZWxwZXJzJztcbmltcG9ydCB7IHN5c3RlbSB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cblxuY29uc3Qgc2hvdWxkID0gY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuZGVzY3JpYmUoJ2V4ZWMnLCBmdW5jdGlvbiAoKSB7XG4gIGl0KCdzaG91bGQgd29yayB3aXRoIGFyZ3VtZW50cyBsaWtlIHNwYXduJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGxldCBjbWQgPSAnbHMnO1xuICAgIGxldCBhcmdzID0gW19fZGlybmFtZV07XG4gICAgbGV0IHtzdGRvdXQsIHN0ZGVyciwgY29kZX0gPSBhd2FpdCBleGVjKGNtZCwgYXJncyk7XG4gICAgc3Rkb3V0LnNob3VsZC5jb250YWluKFwiZXhlYy1zcGVjcy5qc1wiKTtcbiAgICBzdGRlcnIuc2hvdWxkLmVxdWFsKFwiXCIpO1xuICAgIGNvZGUuc2hvdWxkLmVxdWFsKDApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHRocm93IGFuIGVycm9yIGlmIGNvbW1hbmQgZG9lcyBub3QgZXhpc3QnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGNtZCA9ICdkb2Vzbm90ZWV4aXN0JztcbiAgICBsZXQgZXJyO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBleGVjKGNtZCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgZXJyID0gZTtcbiAgICB9XG4gICAgc2hvdWxkLmV4aXN0KGVycik7XG4gICAgZXJyLm1lc3NhZ2Uuc2hvdWxkLmluY2x1ZGUoJ25vdCBmb3VuZCcpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHRocm93IGFuIGVycm9yIHdpdGggYSBiYWQgZXhpdCBjb2RlJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGxldCBjbWQgPSBnZXRGaXh0dXJlKFwiYmFkX2V4aXRcIik7XG4gICAgbGV0IGVycjtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZXhlYyhjbWQpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGVyciA9IGU7XG4gICAgfVxuICAgIHNob3VsZC5leGlzdChlcnIpO1xuICAgIGVyci5zdGRvdXQudHJpbSgpLnNob3VsZC5lcXVhbChcImZvb1wiKTtcbiAgICBlcnIuc3RkZXJyLnRyaW0oKS5zaG91bGQuZXF1YWwoXCJiYXJcIik7XG4gICAgZXJyLmNvZGUuc2hvdWxkLmVxdWFsKDEpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHdvcmsgd2l0aCBzcGFjZXMgaW4gYXJndW1lbnRzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGxldCBjbWQgPSBnZXRGaXh0dXJlKFwiZWNob1wiKTtcbiAgICBsZXQgZWNobzEgPSBcIm15IG5hbWUgaXMgYm9iXCI7XG4gICAgbGV0IGVjaG8yID0gXCJsb2xcIjtcbiAgICBsZXQge3N0ZG91dCwgc3RkZXJyLCBjb2RlfSA9IGF3YWl0IGV4ZWMoY21kLCBbZWNobzEsIGVjaG8yXSk7XG4gICAgc3Rkb3V0LnRyaW0oKS5zaG91bGQuZXF1YWwoZWNobzEpO1xuICAgIHN0ZGVyci50cmltKCkuc2hvdWxkLmVxdWFsKGVjaG8yKTtcbiAgICBjb2RlLnNob3VsZC5lcXVhbCgwKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCB3b3JrIHdpdGggYmFja3NsYXNoZXMgaW4gYXJndW1lbnRzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGxldCBjbWQgPSBnZXRGaXh0dXJlKFwiZWNob1wiKTtcbiAgICBsZXQgZWNobzEgPSBcIm15XFxcXCBuYW1lXFxcXCBpc1xcXFwgYm9iXCI7XG4gICAgbGV0IGVjaG8yID0gXCJsb2xcIjtcbiAgICBsZXQge3N0ZG91dCwgc3RkZXJyLCBjb2RlfSA9IGF3YWl0IGV4ZWMoY21kLCBbZWNobzEsIGVjaG8yXSk7XG4gICAgc3Rkb3V0LnRyaW0oKS5zaG91bGQuZXF1YWwoZWNobzEpO1xuICAgIHN0ZGVyci50cmltKCkuc2hvdWxkLmVxdWFsKGVjaG8yKTtcbiAgICBjb2RlLnNob3VsZC5lcXVhbCgwKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCB3b3JrIHdpdGggc3BhY2VzIGluIGNvbW1hbmRzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGxldCBjbWQgPSBnZXRGaXh0dXJlKFwiZWNobyB3aXRoIHNwYWNlXCIpO1xuICAgIGxldCBlY2hvMSA9IFwiYm9iYm9iXCI7XG4gICAgbGV0IGVjaG8yID0gXCJsb2xcIjtcbiAgICBsZXQge3N0ZG91dCwgc3RkZXJyLCBjb2RlfSA9IGF3YWl0IGV4ZWMoY21kLCBbZWNobzEsIGVjaG8yXSk7XG4gICAgc3Rkb3V0LnRyaW0oKS5zaG91bGQuZXF1YWwoZWNobzEpO1xuICAgIHN0ZGVyci50cmltKCkuc2hvdWxkLmVxdWFsKGVjaG8yKTtcbiAgICBjb2RlLnNob3VsZC5lcXVhbCgwKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCB3b3JrIHdpdGggc3BhY2VzIGluIGNvbW1hbmRzIGFuZCBhcmd1bWVudHMnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGNtZCA9IGdldEZpeHR1cmUoXCJlY2hvIHdpdGggc3BhY2VcIik7XG4gICAgbGV0IGVjaG8xID0gXCJteSBuYW1lIGlzIGJvYlwiO1xuICAgIGxldCBlY2hvMiA9IFwibG9sXCI7XG4gICAgbGV0IHtzdGRvdXQsIHN0ZGVyciwgY29kZX0gPSBhd2FpdCBleGVjKGNtZCwgW2VjaG8xLCBlY2hvMl0pO1xuICAgIHN0ZG91dC50cmltKCkuc2hvdWxkLmVxdWFsKGVjaG8xKTtcbiAgICBzdGRlcnIudHJpbSgpLnNob3VsZC5lcXVhbChlY2hvMik7XG4gICAgY29kZS5zaG91bGQuZXF1YWwoMCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgcmVzcGVjdCBjd2QnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGNtZCA9IHN5c3RlbS5pc1dpbmRvd3MoKSA/IFwiZWNoby5iYXRcIiA6IFwiLi9lY2hvLnNoXCI7XG4gICAgbGV0IGVjaG8xID0gXCJteSBuYW1lIGlzIGJvYlwiO1xuICAgIGxldCBlY2hvMiA9IFwibG9sXCI7XG4gICAgbGV0IGN3ZCA9IHBhdGguZGlybmFtZShnZXRGaXh0dXJlKFwiZWNob1wiKSk7XG4gICAgbGV0IHtzdGRvdXQsIHN0ZGVyciwgY29kZX0gPSBhd2FpdCBleGVjKGNtZCwgW2VjaG8xLCBlY2hvMl0sIHtjd2R9KTtcbiAgICBzdGRvdXQudHJpbSgpLnNob3VsZC5lcXVhbChlY2hvMSk7XG4gICAgc3RkZXJyLnRyaW0oKS5zaG91bGQuZXF1YWwoZWNobzIpO1xuICAgIGNvZGUuc2hvdWxkLmVxdWFsKDApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlc3BlY3QgZW52JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGxldCBjbWQgPSBnZXRGaXh0dXJlKFwiZW52XCIpO1xuICAgIGxldCBlbnYgPSB7Rk9POiBcImxvbG9sXCJ9O1xuICAgIGxldCB7c3Rkb3V0LCBjb2RlfSA9IGF3YWl0IGV4ZWMoY21kLCBbXSwge2Vudn0pO1xuICAgIHN0ZG91dC50cmltKCkuc2hvdWxkLmVxdWFsKGAke2Vudi5GT099ICR7ZW52LkZPT31gKTtcbiAgICBjb2RlLnNob3VsZC5lcXVhbCgwKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBhbGxvdyBhIHRpbWVvdXQgcGFyYW1ldGVyJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGxldCBjbWQgPSBcInNsZWVwXCI7XG4gICAgbGV0IGFyZ3MgPSBbXCIxMFwiXTtcbiAgICBsZXQgZXJyO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBleGVjKGNtZCwgYXJncywge3RpbWVvdXQ6IDUwMH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGVyciA9IGU7XG4gICAgfVxuICAgIHNob3VsZC5leGlzdChlcnIpO1xuICAgIGVyci5tZXNzYWdlLnNob3VsZC5jb250YWluKFwidGltZWQgb3V0XCIpO1xuICAgIGVyci5tZXNzYWdlLnNob3VsZC5jb250YWluKGNtZCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgYWxsb3cgbGFyZ2UgYW1vdW50cyBvZiBvdXRwdXQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy50aW1lb3V0KDI0MDAwKTtcbiAgICBsZXQge3N0ZG91dH0gPSBhd2FpdCBleGVjKGdldEZpeHR1cmUoXCJiaWdidWZmZXIuanNcIikpO1xuICAgIHN0ZG91dC5sZW5ndGguc2hvdWxkLmJlLmFib3ZlKDUxMiAqIDEwMjQpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGlnbm9yZSBvdXRwdXQgaWYgcmVxdWVzdGVkJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGxldCBjbWQgPSBnZXRGaXh0dXJlKFwiZWNoby5zaFwiKTtcbiAgICBsZXQgZWNobzEgPSBcIm15IG5hbWUgaXMgYm9iXCI7XG4gICAgbGV0IHtzdGRvdXQsIGNvZGV9ID0gYXdhaXQgZXhlYyhjbWQsIFtlY2hvMV0sIHtpZ25vcmVPdXRwdXQ6IHRydWV9KTtcbiAgICBzdGRvdXQuc2hvdWxkLmVxdWFsKFwiXCIpO1xuICAgIGNvZGUuc2hvdWxkLmVxdWFsKDApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJldHVybiBhIEJ1ZmZlciBpZiByZXF1ZXN0ZWQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGNtZCA9IGdldEZpeHR1cmUoXCJlY2hvLnNoXCIpO1xuICAgIGxldCBlY2hvMSA9IFwibXkgbmFtZSBpcyBib2JcIjtcbiAgICBsZXQge3N0ZG91dCwgc3RkZXJyLCBjb2RlfSA9IGF3YWl0IGV4ZWMoY21kLCBbZWNobzFdLCB7aXNCdWZmZXI6IHRydWV9KTtcbiAgICBfLmlzU3RyaW5nKHN0ZG91dCkuc2hvdWxkLmJlLmZhbHNlO1xuICAgIF8uaXNCdWZmZXIoc3Rkb3V0KS5zaG91bGQuYmUudHJ1ZTtcbiAgICBfLmlzU3RyaW5nKHN0ZGVycikuc2hvdWxkLmJlLmZhbHNlO1xuICAgIF8uaXNCdWZmZXIoc3RkZXJyKS5zaG91bGQuYmUudHJ1ZTtcbiAgICBjb2RlLnNob3VsZC5lcXVhbCgwKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2JpbmFyeSBvdXRwdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgUE5HX01BR0lDID0gJzg5NTA0ZTQ3JztcbiAgICBjb25zdCBQTkdfTUFHSUNfTEVOR1RIID0gNDtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgYmluYXJ5IG91dHB1dCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ2NhdCcsIFtnZXRGaXh0dXJlKCdzY3JlZW5zaG90LnBuZycpXSwge2VuY29kaW5nOiAnYmluYXJ5J30pO1xuICAgICAgXy5pc1N0cmluZyhzdGRvdXQpLnNob3VsZC5iZS50cnVlO1xuICAgICAgXy5pc0J1ZmZlcihzdGRvdXQpLnNob3VsZC5iZS5mYWxzZTtcbiAgICAgIGNvbnN0IHNpZ25hdHVyZSA9IEJ1ZmZlci5mcm9tKHN0ZG91dCwgJ2JpbmFyeScpLnRvU3RyaW5nKCdoZXgnLCAwLCBQTkdfTUFHSUNfTEVOR1RIKTtcbiAgICAgIHNpZ25hdHVyZS5zaG91bGQuZXFsKFBOR19NQUdJQyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IGJpbmFyeSBvdXRwdXQgYXMgQnVmZmVyJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygnY2F0JywgW2dldEZpeHR1cmUoJ3NjcmVlbnNob3QucG5nJyldLCB7ZW5jb2Rpbmc6ICdiaW5hcnknLCBpc0J1ZmZlcjogdHJ1ZX0pO1xuICAgICAgXy5pc1N0cmluZyhzdGRvdXQpLnNob3VsZC5iZS5mYWxzZTtcbiAgICAgIF8uaXNCdWZmZXIoc3Rkb3V0KS5zaG91bGQuYmUudHJ1ZTtcbiAgICAgIGNvbnN0IHNpZ25hdHVyZSA9IHN0ZG91dC50b1N0cmluZygnaGV4JywgMCwgUE5HX01BR0lDX0xFTkdUSCk7XG4gICAgICBzaWduYXR1cmUuc2hvdWxkLmVxbChQTkdfTUFHSUMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBiaW5hcnkgb3V0cHV0IGZyb20gdGltZW91dCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGV4ZWMoJ2NhdCcsIFtnZXRGaXh0dXJlKCdzY3JlZW5zaG90LnBuZycpXSwge2VuY29kaW5nOiAnYmluYXJ5JywgdGltZW91dDogMX0pO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxldCBzdGRvdXQgPSBlcnIuc3Rkb3V0O1xuICAgICAgICBfLmlzU3RyaW5nKHN0ZG91dCkuc2hvdWxkLmJlLnRydWU7XG4gICAgICAgIF8uaXNCdWZmZXIoc3Rkb3V0KS5zaG91bGQuYmUuZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IGJpbmFyeSBvdXRwdXQgYXMgQnVmZmVyIGZyb20gdGltZW91dCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGV4ZWMoJ2NhdCcsIFtnZXRGaXh0dXJlKCdzY3JlZW5zaG90LnBuZycpXSwge2VuY29kaW5nOiAnYmluYXJ5JywgdGltZW91dDogMSwgaXNCdWZmZXI6IHRydWV9KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBsZXQgc3Rkb3V0ID0gZXJyLnN0ZG91dDtcbiAgICAgICAgXy5pc1N0cmluZyhzdGRvdXQpLnNob3VsZC5iZS5mYWxzZTtcbiAgICAgICAgXy5pc0J1ZmZlcihzdGRvdXQpLnNob3VsZC5iZS50cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLiJ9
