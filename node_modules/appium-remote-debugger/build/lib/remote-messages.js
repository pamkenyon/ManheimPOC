"use strict";

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports['default'] = getRemoteCommand;

var _remoteDebugger = require('./remote-debugger');

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

/*
 * Connection functions
 */

function setConnectionKey(connId) {
  return {
    __argument: {
      WIRConnectionIdentifierKey: connId
    },
    __selector: '_rpc_reportIdentifier:'
  };
}

function connectToApp(connId, appIdKey) {
  return {
    __argument: {
      WIRConnectionIdentifierKey: connId,
      WIRApplicationIdentifierKey: appIdKey
    },
    __selector: '_rpc_forwardGetListing:'
  };
}

function setSenderKey(connId, senderId, appIdKey, pageIdKey) {
  return {
    __argument: {
      WIRApplicationIdentifierKey: appIdKey,
      WIRConnectionIdentifierKey: connId,
      WIRSenderKey: senderId,
      WIRPageIdentifierKey: pageIdKey,
      WIRAutomaticallyPause: false
    },
    __selector: '_rpc_forwardSocketSetup:'
  };
}

/*
 * Action functions
 */

function indicateWebView(connId, appIdKey, pageIdKey, enabled) {
  return {
    __argument: {
      WIRApplicationIdentifierKey: appIdKey,
      WIRIndicateEnabledKey: _lodash2['default'].isUndefined(enabled) ? true : enabled,
      WIRConnectionIdentifierKey: connId,
      WIRPageIdentifierKey: pageIdKey
    },
    __selector: '_rpc_forwardIndicateWebView:'
  };
}

function sendJSCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, js) {
  return command('Runtime.evaluate', { expression: js, returnByValue: true }, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function callJSFunction(connId, senderId, appIdKey, pageIdKey, debuggerType, objId, fn, args) {
  return command('Runtime.callFunctionOn', { objectId: objId, functionDeclaration: fn, arguments: args, returnByValue: true }, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function setUrl(connId, senderId, appIdKey, pageIdKey, debuggerType, url) {
  return command('Page.navigate', { url: url }, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function enablePage(connId, senderId, appIdKey, pageIdKey, debuggerType) {
  return command('Page.enable', {}, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function startTimeline(connId, senderId, appIdKey, pageIdKey, debuggerType) {
  return command('Timeline.start', {}, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function stopTimeline(connId, senderId, appIdKey, pageIdKey, debuggerType) {
  return command('Timeline.stop', {}, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function startConsole(connId, senderId, appIdKey, pageIdKey, debuggerType) {
  return command('Console.enable', {}, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function stopConsole(connId, senderId, appIdKey, pageIdKey, debuggerType) {
  return command('Console.disable', {}, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function startNetwork(connId, senderId, appIdKey, pageIdKey, debuggerType) {
  return command('Network.enable', {}, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function stopNetwork(connId, senderId, appIdKey, pageIdKey, debuggerType) {
  return command('Network.disable', {}, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function getCookies(connId, senderId, appIdKey, pageIdKey, debuggerType, urls) {
  return command('Page.getCookies', { urls: urls }, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function deleteCookie(connId, senderId, appIdKey, pageIdKey, debuggerType, cookieName, url) {
  return command('Page.deleteCookie', { cookieName: cookieName, url: url }, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

/*
 * Internal functions
 */

function command(method, params, appIdKey, connId, senderId, pageIdKey, debuggerType) {
  if (debuggerType !== null && debuggerType === _remoteDebugger.DEBUGGER_TYPES.webkit) {
    return commandWebKit(method, params);
  } else {
    return commandWebInspector(method, params, appIdKey, connId, senderId, pageIdKey);
  }
}

function commandWebInspector(method, params, appIdKey, connId, senderId, pageIdKey) {
  var plist = {
    __argument: {
      WIRApplicationIdentifierKey: appIdKey,
      WIRSocketDataKey: {
        method: method,
        params: {
          objectGroup: 'console',
          includeCommandLineAPI: true,
          doNotPauseOnExceptionsAndMuteConsole: true
        }
      },
      WIRConnectionIdentifierKey: connId,
      WIRSenderKey: senderId,
      WIRPageIdentifierKey: pageIdKey
    },
    __selector: '_rpc_forwardSocketData:'
  };
  if (params) {
    plist.__argument.WIRSocketDataKey.params = _lodash2['default'].extend(plist.__argument.WIRSocketDataKey.params, params);
  }
  return plist;
}

//generate a json request using the webkit protocol
function commandWebKit(method, params) {
  var jsonRequest = {
    method: method,
    params: {
      objectGroup: 'console',
      includeCommandLineAPI: true,
      doNotPauseOnExceptionsAndMuteConsole: true
    }
  };
  if (params) {
    //if there any parameters add them
    jsonRequest.params = _lodash2['default'].extend(jsonRequest.params, params);
  }
  return jsonRequest;
}

function getRemoteCommand(command, opts) {
  var cmd = undefined;

  switch (command) {
    case 'setConnectionKey':
      cmd = setConnectionKey(opts.connId);
      break;
    case 'connectToApp':
      cmd = connectToApp(opts.connId, opts.appIdKey);
      break;
    case 'setSenderKey':
      cmd = setSenderKey(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey);
      break;
    case 'indicateWebView':
      cmd = indicateWebView(opts.connId, opts.appIdKey, opts.pageIdKey, opts.enabled);
      break;
    case 'sendJSCommand':
      cmd = sendJSCommand(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType, opts.command);
      break;
    case 'callJSFunction':
      cmd = callJSFunction(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType, opts.objId, opts.fn, opts.args);
      break;
    case 'setUrl':
      cmd = setUrl(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType, opts.url);
      break;
    case 'enablePage':
      cmd = enablePage(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType);
      break;
    case 'startTimeline':
      cmd = startTimeline(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType);
      break;
    case 'stopTimeline':
      cmd = stopTimeline(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType);
      break;
    case 'startConsole':
      cmd = startConsole(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType);
      break;
    case 'stopConsole':
      cmd = stopConsole(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType);
      break;
    case 'startNetwork':
      cmd = startNetwork(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType);
      break;
    case 'stopNetwork':
      cmd = stopNetwork(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType);
      break;
    case 'getCookies':
      cmd = getCookies(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType, opts.urls);
      break;
    case 'deleteCookie':
      cmd = deleteCookie(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType, opts.cookieName, opts.url);
      break;
    default:
      throw new Error('Unknown command: ' + command);
  }

  return cmd;
}

module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9yZW1vdGUtbWVzc2FnZXMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOzs7Ozs7O3FCQTZLVyxnQkFBZ0I7OzhCQTNLVCxtQkFBbUI7O3NCQUNwQyxRQUFROzs7Ozs7OztBQU10QixTQUFTLGdCQUFnQixDQUFFLE1BQU0sRUFBRTtBQUNqQyxTQUFPO0FBQ0wsY0FBVSxFQUFFO0FBQ1YsZ0NBQTBCLEVBQUUsTUFBTTtLQUNuQztBQUNELGNBQVUsRUFBRyx3QkFBd0I7R0FDdEMsQ0FBQztDQUNIOztBQUVELFNBQVMsWUFBWSxDQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUU7QUFDdkMsU0FBTztBQUNMLGNBQVUsRUFBRTtBQUNWLGdDQUEwQixFQUFFLE1BQU07QUFDbEMsaUNBQTJCLEVBQUUsUUFBUTtLQUN0QztBQUNELGNBQVUsRUFBRyx5QkFBeUI7R0FDdkMsQ0FBQztDQUNIOztBQUVELFNBQVMsWUFBWSxDQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRTtBQUM1RCxTQUFPO0FBQ0wsY0FBVSxFQUFFO0FBQ1YsaUNBQTJCLEVBQUUsUUFBUTtBQUNyQyxnQ0FBMEIsRUFBRSxNQUFNO0FBQ2xDLGtCQUFZLEVBQUUsUUFBUTtBQUN0QiwwQkFBb0IsRUFBRSxTQUFTO0FBQy9CLDJCQUFxQixFQUFFLEtBQUs7S0FDN0I7QUFDRCxjQUFVLEVBQUUsMEJBQTBCO0dBQ3ZDLENBQUM7Q0FDSDs7Ozs7O0FBTUQsU0FBUyxlQUFlLENBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFO0FBQzlELFNBQU87QUFDTCxjQUFVLEVBQUU7QUFDVixpQ0FBMkIsRUFBRSxRQUFRO0FBQ3JDLDJCQUFxQixFQUFFLG9CQUFFLFdBQVcsQ0FBQyxPQUFPLENBQUMsR0FBRyxJQUFJLEdBQUcsT0FBTztBQUM5RCxnQ0FBMEIsRUFBRSxNQUFNO0FBQ2xDLDBCQUFvQixFQUFFLFNBQVM7S0FDaEM7QUFD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QixPQUFPLENBQUcsQ0FBQztBQUFBLEdBQ2xEOztBQUVELFNBQU8sR0FBRyxDQUFDO0NBQ1oiLCJmaWxlIjoibGliL3JlbW90ZS1tZXNzYWdlcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgeyBERUJVR0dFUl9UWVBFUyB9IGZyb20gJy4vcmVtb3RlLWRlYnVnZ2VyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbi8qXG4gKiBDb25uZWN0aW9uIGZ1bmN0aW9uc1xuICovXG5cbmZ1bmN0aW9uIHNldENvbm5lY3Rpb25LZXkgKGNvbm5JZCkge1xuICByZXR1cm4ge1xuICAgIF9fYXJndW1lbnQ6IHtcbiAgICAgIFdJUkNvbm5lY3Rpb25JZGVudGlmaWVyS2V5OiBjb25uSWRcbiAgICB9LFxuICAgIF9fc2VsZWN0b3IgOiAnX3JwY19yZXBvcnRJZGVudGlmaWVyOidcbiAgfTtcbn1cblxuZnVuY3Rpb24gY29ubmVjdFRvQXBwIChjb25uSWQsIGFwcElkS2V5KSB7XG4gIHJldHVybiB7XG4gICAgX19hcmd1bWVudDoge1xuICAgICAgV0lSQ29ubmVjdGlvbklkZW50aWZpZXJLZXk6IGNvbm5JZCxcbiAgICAgIFdJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleTogYXBwSWRLZXlcbiAgICB9LFxuICAgIF9fc2VsZWN0b3IgOiAnX3JwY19mb3J3YXJkR2V0TGlzdGluZzonXG4gIH07XG59XG5cbmZ1bmN0aW9uIHNldFNlbmRlcktleSAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSkge1xuICByZXR1cm4ge1xuICAgIF9fYXJndW1lbnQ6IHtcbiAgICAgIFdJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleTogYXBwSWRLZXksXG4gICAgICBXSVJDb25uZWN0aW9uSWRlbnRpZmllcktleTogY29ubklkLFxuICAgICAgV0lSU2VuZGVyS2V5OiBzZW5kZXJJZCxcbiAgICAgIFdJUlBhZ2VJZGVudGlmaWVyS2V5OiBwYWdlSWRLZXksXG4gICAgICBXSVJBdXRvbWF0aWNhbGx5UGF1c2U6IGZhbHNlXG4gICAgfSxcbiAgICBfX3NlbGVjdG9yOiAnX3JwY19mb3J3YXJkU29ja2V0U2V0dXA6J1xuICB9O1xufVxuXG4vKlxuICogQWN0aW9uIGZ1bmN0aW9uc1xuICovXG5cbmZ1bmN0aW9uIGluZGljYXRlV2ViVmlldyAoY29ubklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBlbmFibGVkKSB7XG4gIHJldHVybiB7XG4gICAgX19hcmd1bWVudDoge1xuICAgICAgV0lSQXBwbGljYXRpb25JZGVudGlmaWVyS2V5OiBhcHBJZEtleSxcbiAgICAgIFdJUkluZGljYXRlRW5hYmxlZEtleTogXy5pc1VuZGVmaW5lZChlbmFibGVkKSA/IHRydWUgOiBlbmFibGVkLFxuICAgICAgV0lSQ29ubmVjdGlvbklkZW50aWZpZXJLZXk6IGNvbm5JZCxcbiAgICAgIFdJUlBhZ2VJZGVudGlmaWVyS2V5OiBwYWdlSWRLZXlcbiAgICB9LFxuICAgIF9fc2VsZWN0b3I6ICdfcnBjX2ZvcndhcmRJbmRpY2F0ZVdlYlZpZXc6J1xuICB9O1xufVxuXG5mdW5jdGlvbiBzZW5kSlNDb21tYW5kIChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUsIGpzKSB7XG4gIHJldHVybiBjb21tYW5kKCdSdW50aW1lLmV2YWx1YXRlJyxcbiAgICAgIHtleHByZXNzaW9uOiBqcywgcmV0dXJuQnlWYWx1ZTogdHJ1ZX0sIGFwcElkS2V5LCBjb25uSWQsIHNlbmRlcklkLCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSk7XG59XG5cbmZ1bmN0aW9uIGNhbGxKU0Z1bmN0aW9uIChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUsIG9iaklkLCBmbiwgYXJncykge1xuICByZXR1cm4gY29tbWFuZCgnUnVudGltZS5jYWxsRnVuY3Rpb25PbicsXG4gICAgICB7b2JqZWN0SWQ6IG9iaklkLCBmdW5jdGlvbkRlY2xhcmF0aW9uOiBmbiwgYXJndW1lbnRzOiBhcmdzLCByZXR1cm5CeVZhbHVlOiB0cnVlfSxcbiAgICAgIGFwcElkS2V5LCBjb25uSWQsIHNlbmRlcklkLCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSk7XG59XG5cbmZ1bmN0aW9uIHNldFVybCAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlLCB1cmwpIHtcbiAgcmV0dXJuIGNvbW1hbmQoJ1BhZ2UubmF2aWdhdGUnLCB7dXJsfSwgYXBwSWRLZXksIGNvbm5JZCxcbiAgICAgIHNlbmRlcklkLCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSk7XG59XG5cbmZ1bmN0aW9uIGVuYWJsZVBhZ2UgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSkge1xuICByZXR1cm4gY29tbWFuZCgnUGFnZS5lbmFibGUnLCB7fSwgYXBwSWRLZXksIGNvbm5JZCwgc2VuZGVySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpO1xufVxuXG5mdW5jdGlvbiBzdGFydFRpbWVsaW5lIChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpIHtcbiAgcmV0dXJuIGNvbW1hbmQoJ1RpbWVsaW5lLnN0YXJ0Jywge30sIGFwcElkS2V5LCBjb25uSWQsIHNlbmRlcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlKTtcbn1cblxuZnVuY3Rpb24gc3RvcFRpbWVsaW5lIChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpIHtcbiAgcmV0dXJuIGNvbW1hbmQoJ1RpbWVsaW5lLnN0b3AnLCB7fSwgYXBwSWRLZXksIGNvbm5JZCwgc2VuZGVySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpO1xufVxuXG5mdW5jdGlvbiBzdGFydENvbnNvbGUgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSkge1xuICByZXR1cm4gY29tbWFuZCgnQ29uc29sZS5lbmFibGUnLCB7fSwgYXBwSWRLZXksIGNvbm5JZCwgc2VuZGVySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpO1xufVxuXG5mdW5jdGlvbiBzdG9wQ29uc29sZSAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlKSB7XG4gIHJldHVybiBjb21tYW5kKCdDb25zb2xlLmRpc2FibGUnLCB7fSwgYXBwSWRLZXksIGNvbm5JZCwgc2VuZGVySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpO1xufVxuXG5mdW5jdGlvbiBzdGFydE5ldHdvcmsgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSkge1xuICByZXR1cm4gY29tbWFuZCgnTmV0d29yay5lbmFibGUnLCB7fSwgYXBwSWRLZXksIGNvbm5JZCwgc2VuZGVySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpO1xufVxuXG5mdW5jdGlvbiBzdG9wTmV0d29yayAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlKSB7XG4gIHJldHVybiBjb21tYW5kKCdOZXR3b3JrLmRpc2FibGUnLCB7fSwgYXBwSWRLZXksIGNvbm5JZCwgc2VuZGVySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpO1xufVxuXG5mdW5jdGlvbiBnZXRDb29raWVzIChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUsIHVybHMpIHtcbiAgcmV0dXJuIGNvbW1hbmQoJ1BhZ2UuZ2V0Q29va2llcycsIHt1cmxzfSwgYXBwSWRLZXksIGNvbm5JZCwgc2VuZGVySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpO1xufVxuXG5mdW5jdGlvbiBkZWxldGVDb29raWUgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSwgY29va2llTmFtZSwgdXJsKSB7XG4gIHJldHVybiBjb21tYW5kKCdQYWdlLmRlbGV0ZUNvb2tpZScsIHtjb29raWVOYW1lLCB1cmx9LCBhcHBJZEtleSwgY29ubklkLCBzZW5kZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSk7XG59XG5cblxuLypcbiAqIEludGVybmFsIGZ1bmN0aW9uc1xuICovXG5cbmZ1bmN0aW9uIGNvbW1hbmQgKG1ldGhvZCwgcGFyYW1zLCBhcHBJZEtleSwgY29ubklkLCBzZW5kZXJJZCwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpIHtcbiAgaWYgKGRlYnVnZ2VyVHlwZSAhPT0gbnVsbCAmJiBkZWJ1Z2dlclR5cGUgPT09IERFQlVHR0VSX1RZUEVTLndlYmtpdCkge1xuICAgIHJldHVybiBjb21tYW5kV2ViS2l0KG1ldGhvZCwgcGFyYW1zKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gY29tbWFuZFdlYkluc3BlY3RvcihtZXRob2QsIHBhcmFtcywgYXBwSWRLZXksIGNvbm5JZCwgc2VuZGVySWQsIHBhZ2VJZEtleSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gY29tbWFuZFdlYkluc3BlY3RvciAobWV0aG9kLCBwYXJhbXMsIGFwcElkS2V5LCBjb25uSWQsIHNlbmRlcklkLCBwYWdlSWRLZXkpIHtcbiAgbGV0IHBsaXN0ID0ge1xuICAgIF9fYXJndW1lbnQ6IHtcbiAgICAgIFdJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleTogYXBwSWRLZXksXG4gICAgICBXSVJTb2NrZXREYXRhS2V5OiB7XG4gICAgICAgIG1ldGhvZCxcbiAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgb2JqZWN0R3JvdXA6ICdjb25zb2xlJyxcbiAgICAgICAgICBpbmNsdWRlQ29tbWFuZExpbmVBUEk6IHRydWUsXG4gICAgICAgICAgZG9Ob3RQYXVzZU9uRXhjZXB0aW9uc0FuZE11dGVDb25zb2xlOiB0cnVlLFxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgV0lSQ29ubmVjdGlvbklkZW50aWZpZXJLZXk6IGNvbm5JZCxcbiAgICAgIFdJUlNlbmRlcktleTogc2VuZGVySWQsXG4gICAgICBXSVJQYWdlSWRlbnRpZmllcktleTogcGFnZUlkS2V5XG4gICAgfSxcbiAgICBfX3NlbGVjdG9yOiAnX3JwY19mb3J3YXJkU29ja2V0RGF0YTonXG4gIH07XG4gIGlmIChwYXJhbXMpIHtcbiAgICBwbGlzdC5fX2FyZ3VtZW50LldJUlNvY2tldERhdGFLZXkucGFyYW1zID1cbiAgICAgIF8uZXh0ZW5kKHBsaXN0Ll9fYXJndW1lbnQuV0lSU29ja2V0RGF0YUtleS5wYXJhbXMsIHBhcmFtcyk7XG4gIH1cbiAgcmV0dXJuIHBsaXN0O1xufVxuXG4vL2dlbmVyYXRlIGEganNvbiByZXF1ZXN0IHVzaW5nIHRoZSB3ZWJraXQgcHJvdG9jb2xcbmZ1bmN0aW9uIGNvbW1hbmRXZWJLaXQgKG1ldGhvZCwgcGFyYW1zKSB7XG4gIGxldCBqc29uUmVxdWVzdCA9IHtcbiAgICBtZXRob2QsXG4gICAgcGFyYW1zOiB7XG4gICAgICBvYmplY3RHcm91cDogJ2NvbnNvbGUnLFxuICAgICAgaW5jbHVkZUNvbW1hbmRMaW5lQVBJOiB0cnVlLFxuICAgICAgZG9Ob3RQYXVzZU9uRXhjZXB0aW9uc0FuZE11dGVDb25zb2xlOiB0cnVlXG4gICAgfVxuICB9O1xuICBpZiAocGFyYW1zKSB7XG4gICAgLy9pZiB0aGVyZSBhbnkgcGFyYW1ldGVycyBhZGQgdGhlbVxuICAgIGpzb25SZXF1ZXN0LnBhcmFtcyA9IF8uZXh0ZW5kKGpzb25SZXF1ZXN0LnBhcmFtcywgcGFyYW1zKTtcbiAgfVxuICByZXR1cm4ganNvblJlcXVlc3Q7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGdldFJlbW90ZUNvbW1hbmQgKGNvbW1hbmQsIG9wdHMpIHtcbiAgbGV0IGNtZDtcblxuICBzd2l0Y2ggKGNvbW1hbmQpIHtcbiAgICBjYXNlICdzZXRDb25uZWN0aW9uS2V5JzpcbiAgICAgIGNtZCA9IHNldENvbm5lY3Rpb25LZXkob3B0cy5jb25uSWQpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnY29ubmVjdFRvQXBwJzpcbiAgICAgIGNtZCA9IGNvbm5lY3RUb0FwcChvcHRzLmNvbm5JZCwgb3B0cy5hcHBJZEtleSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdzZXRTZW5kZXJLZXknOlxuICAgICAgY21kID0gc2V0U2VuZGVyS2V5KG9wdHMuY29ubklkLCBvcHRzLnNlbmRlcklkLCBvcHRzLmFwcElkS2V5LFxuICAgICAgICAgICAgICBvcHRzLnBhZ2VJZEtleSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdpbmRpY2F0ZVdlYlZpZXcnOlxuICAgICAgY21kID0gaW5kaWNhdGVXZWJWaWV3KG9wdHMuY29ubklkLCBvcHRzLmFwcElkS2V5LCBvcHRzLnBhZ2VJZEtleSxcbiAgICAgICAgICAgICAgb3B0cy5lbmFibGVkKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3NlbmRKU0NvbW1hbmQnOlxuICAgICAgY21kID0gc2VuZEpTQ29tbWFuZChvcHRzLmNvbm5JZCwgb3B0cy5zZW5kZXJJZCwgb3B0cy5hcHBJZEtleSxcbiAgICAgICAgICAgICAgb3B0cy5wYWdlSWRLZXksIG9wdHMuZGVidWdnZXJUeXBlLCBvcHRzLmNvbW1hbmQpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnY2FsbEpTRnVuY3Rpb24nOlxuICAgICAgY21kID0gY2FsbEpTRnVuY3Rpb24ob3B0cy5jb25uSWQsIG9wdHMuc2VuZGVySWQsIG9wdHMuYXBwSWRLZXksXG4gICAgICAgICAgICAgIG9wdHMucGFnZUlkS2V5LCBvcHRzLmRlYnVnZ2VyVHlwZSwgb3B0cy5vYmpJZCwgb3B0cy5mbixcbiAgICAgICAgICAgICAgb3B0cy5hcmdzKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3NldFVybCc6XG4gICAgICBjbWQgPSBzZXRVcmwob3B0cy5jb25uSWQsIG9wdHMuc2VuZGVySWQsIG9wdHMuYXBwSWRLZXksIG9wdHMucGFnZUlkS2V5LFxuICAgICAgICAgICAgICBvcHRzLmRlYnVnZ2VyVHlwZSwgb3B0cy51cmwpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnZW5hYmxlUGFnZSc6XG4gICAgICBjbWQgPSBlbmFibGVQYWdlKG9wdHMuY29ubklkLCBvcHRzLnNlbmRlcklkLCBvcHRzLmFwcElkS2V5LFxuICAgICAgICAgICAgICBvcHRzLnBhZ2VJZEtleSwgb3B0cy5kZWJ1Z2dlclR5cGUpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnc3RhcnRUaW1lbGluZSc6XG4gICAgICBjbWQgPSBzdGFydFRpbWVsaW5lKG9wdHMuY29ubklkLCBvcHRzLnNlbmRlcklkLCBvcHRzLmFwcElkS2V5LFxuICAgICAgICAgICAgICBvcHRzLnBhZ2VJZEtleSwgb3B0cy5kZWJ1Z2dlclR5cGUpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnc3RvcFRpbWVsaW5lJzpcbiAgICAgIGNtZCA9IHN0b3BUaW1lbGluZShvcHRzLmNvbm5JZCwgb3B0cy5zZW5kZXJJZCwgb3B0cy5hcHBJZEtleSxcbiAgICAgICAgICAgICAgb3B0cy5wYWdlSWRLZXksIG9wdHMuZGVidWdnZXJUeXBlKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3N0YXJ0Q29uc29sZSc6XG4gICAgICBjbWQgPSBzdGFydENvbnNvbGUob3B0cy5jb25uSWQsIG9wdHMuc2VuZGVySWQsIG9wdHMuYXBwSWRLZXksXG4gICAgICAgICAgICAgIG9wdHMucGFnZUlkS2V5LCBvcHRzLmRlYnVnZ2VyVHlwZSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdzdG9wQ29uc29sZSc6XG4gICAgICBjbWQgPSBzdG9wQ29uc29sZShvcHRzLmNvbm5JZCwgb3B0cy5zZW5kZXJJZCwgb3B0cy5hcHBJZEtleSxcbiAgICAgICAgICAgICAgb3B0cy5wYWdlSWRLZXksIG9wdHMuZGVidWdnZXJUeXBlKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3N0YXJ0TmV0d29yayc6XG4gICAgICBjbWQgPSBzdGFydE5ldHdvcmsob3B0cy5jb25uSWQsIG9wdHMuc2VuZGVySWQsIG9wdHMuYXBwSWRLZXksXG4gICAgICAgICAgICAgIG9wdHMucGFnZUlkS2V5LCBvcHRzLmRlYnVnZ2VyVHlwZSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdzdG9wTmV0d29yayc6XG4gICAgICBjbWQgPSBzdG9wTmV0d29yayhvcHRzLmNvbm5JZCwgb3B0cy5zZW5kZXJJZCwgb3B0cy5hcHBJZEtleSxcbiAgICAgICAgICAgICAgb3B0cy5wYWdlSWRLZXksIG9wdHMuZGVidWdnZXJUeXBlKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2dldENvb2tpZXMnOlxuICAgICAgY21kID0gZ2V0Q29va2llcyhvcHRzLmNvbm5JZCwgb3B0cy5zZW5kZXJJZCwgb3B0cy5hcHBJZEtleSxcbiAgICAgICAgICAgICAgb3B0cy5wYWdlSWRLZXksIG9wdHMuZGVidWdnZXJUeXBlLCBvcHRzLnVybHMpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnZGVsZXRlQ29va2llJzpcbiAgICAgIGNtZCA9IGRlbGV0ZUNvb2tpZShvcHRzLmNvbm5JZCwgb3B0cy5zZW5kZXJJZCwgb3B0cy5hcHBJZEtleSxcbiAgICAgICAgICAgICAgb3B0cy5wYWdlSWRLZXksIG9wdHMuZGVidWdnZXJUeXBlLCBvcHRzLmNvb2tpZU5hbWUsIG9wdHMudXJsKTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gY29tbWFuZDogJHtjb21tYW5kfWApO1xuICB9XG5cbiAgcmV0dXJuIGNtZDtcbn1cbiJdLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
