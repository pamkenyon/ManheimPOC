'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _wd = require('wd');

var _wd2 = _interopRequireDefault(_wd);

var _helpersSession = require('../helpers/session');

var _desired = require('../desired');

var _ = require('../../..');

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('elementByXPath', function () {
  this.timeout(_helpersSession.MOCHA_TIMEOUT);

  var driver = undefined;
  var server = undefined;
  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _.startServer)(_helpersSession.PORT, _helpersSession.HOST));

        case 2:
          server = context$2$0.sent;

          driver = _wd2['default'].promiseChainRemote(_helpersSession.HOST, _helpersSession.PORT);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  after(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.prev = 0;
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(server.close());

        case 3:
          context$2$0.next = 7;
          break;

        case 5:
          context$2$0.prev = 5;
          context$2$0.t0 = context$2$0['catch'](0);

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this, [[0, 5]]);
  });
  beforeEach(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.prev = 0;
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(driver.init(_desired.APIDEMO_CAPS));

        case 3:
          context$2$0.next = 7;
          break;

        case 5:
          context$2$0.prev = 5;
          context$2$0.t0 = context$2$0['catch'](0);

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this, [[0, 5]]);
  });
  afterEach(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.prev = 0;
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(driver.quit());

        case 3:
          context$2$0.next = 7;
          break;

        case 5:
          context$2$0.prev = 5;
          context$2$0.t0 = context$2$0['catch'](0);

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this, [[0, 5]]);
  });

  it('should find an element by it\'s xpath', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath("//*[@text='Animation']"));

        case 2:
          el = context$2$0.sent;

          el.should.exist;
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(el.click());

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  it('should find multiple elements that match one xpath', function callee$1$0() {
    var els;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementsByXPath('//android.widget.TextView'));

        case 2:
          els = context$2$0.sent;

          els.length.should.be.above(1);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  it('should get the first element of an xpath that matches more than one element', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//android.widget.TextView'));

        case 2:
          el = context$2$0.sent;

          el.should.exist;

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  it('should throw a stale element exception if clicking on element that does not exist', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath("//*[@content-desc='Animation']"));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(el.click());

        case 5:
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(el.click().should.eventually.be.rejectedWith(/no longer attached /));

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  it('should get the isDisplayed attribute on the same element twice', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath("//*[@content-desc='Animation']"));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(el.isDisplayed().should.eventually.be['true']);

        case 5:
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(el.isDisplayed().should.eventually.be['true']);

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  it('should match an element if the element is off-screen but has an accessibility id', function callee$1$0() {
    var el, moveToEl;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByAccessibilityId('Views'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(el.click());

        case 5:
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(driver.elementByAccessibilityId('WebView'));

        case 7:
          moveToEl = context$2$0.sent;
          context$2$0.next = 10;
          return _regeneratorRuntime.awrap(moveToEl.click());

        case 10:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
});

// Click on an element that is at the bottom of the list
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZnVuY3Rpb25hbC9jb21tYW5kcy9maW5kLWUyZS1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7b0JBQWlCLE1BQU07Ozs7OEJBQ0ksa0JBQWtCOzs7O2tCQUM5QixJQUFJOzs7OzhCQUN1QixvQkFBb0I7O3VCQUNqQyxZQUFZOztnQkFDYixVQUFVOztBQUd0QyxrQkFBSyxNQUFNLEVBQUUsQ0FBQztBQUNkLGtCQUFLLEdBQUcsNkJBQWdCLENBQUM7O0FBRXpCLFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxZQUFZO0FBQ3JDLE1BQUksQ0FBQyxPQUFPLCtCQUFlLENBQUM7O0FBRTVCLE1BQUksTUFBTSxZQUFBLENBQUM7QUFDWCxNQUFJLE1BQU0sWUFBQSxDQUFDO0FBQ1gsUUFBTSxDQUFDOzs7OzsyQ0FDVSw4REFBdUI7OztBQUF0QyxnQkFBTTs7QUFDTixnQkFBTSxHQUFHLGdCQUFHLGtCQUFrQiw0Q0FBWSxDQUFDOzs7Ozs7O0dBQzVDLENBQUMsQ0FBQztBQUNILE9BQUssQ0FBQzs7Ozs7OzJDQUVJLE1BQU0sQ0FBQyxLQUFLLEVBQUU7Ozs7Ozs7Ozs7Ozs7OztHQUV2QixDQUFDLENBQUM7QUFDSCxZQUFVLENBQUM7Ozs7OzsyQ0FFRCxNQUFNLENBQUMsSUFBSSx1QkFBYzs7Ozs7Ozs7Ozs7Ozs7O0dBRWxDLENBQUMsQ0FBQztBQUNILFdBQVMsQ0FBQzs7Ozs7OzJDQUVBLE1BQU0sQ0FBQyxJQUFJLEVBQUU7Ozs7Ozs7Ozs7Ozs7OztHQUV0QixDQUFDLENBQUM7O0FBRUgsSUFBRSxDQUFDLHVDQUF1QyxFQUFFO1FBQ3RDLEVBQUU7Ozs7OzJDQUFTLE1BQU0sQ0FBQyxjQUFjLENBQUMsd0JBQXdCLENBQUM7OztBQUExRCxZQUFFOztBQUNOLFlBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDOzsyQ0FDVixFQUFFLENBQUMsS0FBSyxFQUFFOzs7Ozs7O0dBQ2pCLENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyxvREFBb0QsRUFBRTtRQUNuRCxHQUFHOzs7OzsyQ0FBUyxNQUFNLENBQUMsZUFBZSxDQUFDLDJCQUEyQixDQUFDOzs7QUFBL0QsYUFBRzs7QUFDUCxhQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDOzs7Ozs7O0dBQy9CLENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyw2RUFBNkUsRUFBRTtRQUM1RSxFQUFFOzs7OzsyQ0FBUyxNQUFNLENBQUMsY0FBYyxDQUFDLDJCQUEyQixDQUFDOzs7QUFBN0QsWUFBRTs7QUFDTixZQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQzs7Ozs7OztHQUNqQixDQUFDLENBQUM7QUFDSCxJQUFFLENBQUMsbUZBQW1GLEVBQUU7UUFDbEYsRUFBRTs7Ozs7MkNBQVMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxnQ0FBZ0MsQ0FBQzs7O0FBQWxFLFlBQUU7OzJDQUNBLEVBQUUsQ0FBQyxLQUFLLEVBQUU7Ozs7MkNBQ1YsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxxQkFBcUIsQ0FBQzs7Ozs7OztHQUMxRSxDQUFDLENBQUM7QUFDSCxJQUFFLENBQUMsZ0VBQWdFLEVBQUU7UUFDL0QsRUFBRTs7Ozs7MkNBQVMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxnQ0FBZ0MsQ0FBQzs7O0FBQWxFLFlBQUU7OzJDQUNBLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQUUsUUFBSzs7OzsyQ0FDMUMsRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxRQUFLOzs7Ozs7O0dBQ2pELENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyxrRkFBa0YsRUFBRTtRQUNqRixFQUFFLEVBSUYsUUFBUTs7Ozs7MkNBSkcsTUFBTSxDQUFDLHdCQUF3QixDQUFDLE9BQU8sQ0FBQzs7O0FBQW5ELFlBQUU7OzJDQUNBLEVBQUUsQ0FBQyxLQUFLLEVBQUU7Ozs7MkNBR0ssTUFBTSxDQUFDLHdCQUF3QixDQUFDLFNBQVMsQ0FBQzs7O0FBQTNELGtCQUFROzsyQ0FDTixRQUFRLENBQUMsS0FBSyxFQUFFOzs7Ozs7O0dBQ3ZCLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L2Z1bmN0aW9uYWwvY29tbWFuZHMvZmluZC1lMmUtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCB3ZCBmcm9tICd3ZCc7XG5pbXBvcnQgeyBIT1NULCBQT1JULCBNT0NIQV9USU1FT1VUIH0gZnJvbSAnLi4vaGVscGVycy9zZXNzaW9uJztcbmltcG9ydCB7IEFQSURFTU9fQ0FQUyB9IGZyb20gJy4uL2Rlc2lyZWQnO1xuaW1wb3J0IHsgc3RhcnRTZXJ2ZXIgfSBmcm9tICcuLi8uLi8uLic7XG5cblxuY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuZGVzY3JpYmUoJ2VsZW1lbnRCeVhQYXRoJywgZnVuY3Rpb24gKCkge1xuICB0aGlzLnRpbWVvdXQoTU9DSEFfVElNRU9VVCk7XG5cbiAgbGV0IGRyaXZlcjtcbiAgbGV0IHNlcnZlcjtcbiAgYmVmb3JlKGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBzZXJ2ZXIgPSBhd2FpdCBzdGFydFNlcnZlcihQT1JULCBIT1NUKTtcbiAgICBkcml2ZXIgPSB3ZC5wcm9taXNlQ2hhaW5SZW1vdGUoSE9TVCwgUE9SVCk7XG4gIH0pO1xuICBhZnRlcihhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHNlcnZlci5jbG9zZSgpO1xuICAgIH0gY2F0Y2ggKGlnbikge31cbiAgfSk7XG4gIGJlZm9yZUVhY2goYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBkcml2ZXIuaW5pdChBUElERU1PX0NBUFMpO1xuICAgIH0gY2F0Y2ggKGlnbikge31cbiAgfSk7XG4gIGFmdGVyRWFjaChhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGRyaXZlci5xdWl0KCk7XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICB9KTtcblxuICBpdCgnc2hvdWxkIGZpbmQgYW4gZWxlbWVudCBieSBpdFxcJ3MgeHBhdGgnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmVsZW1lbnRCeVhQYXRoKFwiLy8qW0B0ZXh0PSdBbmltYXRpb24nXVwiKTtcbiAgICBlbC5zaG91bGQuZXhpc3Q7XG4gICAgYXdhaXQgZWwuY2xpY2soKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZmluZCBtdWx0aXBsZSBlbGVtZW50cyB0aGF0IG1hdGNoIG9uZSB4cGF0aCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgZWxzID0gYXdhaXQgZHJpdmVyLmVsZW1lbnRzQnlYUGF0aCgnLy9hbmRyb2lkLndpZGdldC5UZXh0VmlldycpO1xuICAgIGVscy5sZW5ndGguc2hvdWxkLmJlLmFib3ZlKDEpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBnZXQgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYW4geHBhdGggdGhhdCBtYXRjaGVzIG1vcmUgdGhhbiBvbmUgZWxlbWVudCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZWxlbWVudEJ5WFBhdGgoJy8vYW5kcm9pZC53aWRnZXQuVGV4dFZpZXcnKTtcbiAgICBlbC5zaG91bGQuZXhpc3Q7XG4gIH0pO1xuICBpdCgnc2hvdWxkIHRocm93IGEgc3RhbGUgZWxlbWVudCBleGNlcHRpb24gaWYgY2xpY2tpbmcgb24gZWxlbWVudCB0aGF0IGRvZXMgbm90IGV4aXN0JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5lbGVtZW50QnlYUGF0aChcIi8vKltAY29udGVudC1kZXNjPSdBbmltYXRpb24nXVwiKTtcbiAgICBhd2FpdCBlbC5jbGljaygpO1xuICAgIGF3YWl0IGVsLmNsaWNrKCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKC9ubyBsb25nZXIgYXR0YWNoZWQgLyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGdldCB0aGUgaXNEaXNwbGF5ZWQgYXR0cmlidXRlIG9uIHRoZSBzYW1lIGVsZW1lbnQgdHdpY2UnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmVsZW1lbnRCeVhQYXRoKFwiLy8qW0Bjb250ZW50LWRlc2M9J0FuaW1hdGlvbiddXCIpO1xuICAgIGF3YWl0IGVsLmlzRGlzcGxheWVkKCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUudHJ1ZTtcbiAgICBhd2FpdCBlbC5pc0Rpc3BsYXllZCgpLnNob3VsZC5ldmVudHVhbGx5LmJlLnRydWU7XG4gIH0pO1xuICBpdCgnc2hvdWxkIG1hdGNoIGFuIGVsZW1lbnQgaWYgdGhlIGVsZW1lbnQgaXMgb2ZmLXNjcmVlbiBidXQgaGFzIGFuIGFjY2Vzc2liaWxpdHkgaWQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmVsZW1lbnRCeUFjY2Vzc2liaWxpdHlJZCgnVmlld3MnKTtcbiAgICBhd2FpdCBlbC5jbGljaygpO1xuXG4gICAgLy8gQ2xpY2sgb24gYW4gZWxlbWVudCB0aGF0IGlzIGF0IHRoZSBib3R0b20gb2YgdGhlIGxpc3RcbiAgICBsZXQgbW92ZVRvRWwgPSBhd2FpdCBkcml2ZXIuZWxlbWVudEJ5QWNjZXNzaWJpbGl0eUlkKCdXZWJWaWV3Jyk7XG4gICAgYXdhaXQgbW92ZVRvRWwuY2xpY2soKTtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4ifQ==
